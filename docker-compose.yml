version: "3.8"

services:
  api:
    image: carvin/api:dev
    container_name: carvin-api-dev
    build:
      context: ./api
      args:
        workdir: /home/node/carvin/api
        tz: Etc/UTC
    environment:
      AWS_REGION: eu-central-1
      AWS_ACCESS_KEY_ID: ${AWS_ACCESS_KEY_ID}
      AWS_SECRET_ACCESS_KEY: ${AWS_SECRET_ACCESS_KEY}
      API_PORT: 3000
      MONGO_DB: carvin
      MONGO_HOST: carvin-mongo-dev
      MONGO_URL_PARAMS: "?authSource=admin&ssl=false&appname=CarVIN&retryWrites=true&w=majority"
      MONGO_PASS: Dev_Pass123
      MONGO_PORT: 27017
      MONGO_USER: dev
      NODE_ENV: development
      TZ: Etc/UTC
    tty: true
    command: "yarn start-dev"
    volumes:
      - ./api:/home/node/carvin/api
    ports:
      - "0.0.0.0:3000:3000"
      - "0.0.0.0:3443:3443"
      - "0.0.0.0:9229:9229"
    restart: always
    depends_on:
      - mongo

  front:
    image: carvin/front:dev
    container_name: carvin-ui-dev
    build:
      context: ./ui
      args:
        workdir: /home/node/carvin/ui
        tz: Etc/UTC
        node_env: development
    environment:
      TZ: Etc/UTC
      NODE_ENV: development
    env_file:
      - ui/.env
    tty: true
#    command: "yarn ssr-build && yarn sls-local"
    command: "yarn start"
    volumes:
      - ./ui:/home/node/carvin/ui
    ports:
      - "0.0.0.0:4000:4000"
      - "0.0.0.0:4200:4200"
      - "0.0.0.0:4300:4300"
      - "0.0.0.0:9222:9222"
    depends_on:
      - api
